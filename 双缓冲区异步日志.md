# log

log 的实现借鉴 muduo，其日志系统分为前端和后端，前端往后端里面写，后端日志往磁盘里面写，至于为什么要区分前端和后端，
因为只要涉及到 IO，无论是磁盘 IO 还是网络 IO，肯定是慢的，这样便会影响其他操作

后端主要是由多个缓冲区构成的，集满缓冲区或者定时就像文件中写入，采用 muduo 中双缓冲区的思想，实际采用了 4 个缓冲区，分两组，
每一组有一个主缓冲区，防止写满了没地方写，写满或者时间到了就和另外两个交换文件指针，然后把满缓冲区中的往文件中写

与 log 相关的类包括 FileUtil、AsyncLogging、LogStream、Logging，其中前四个当中每一个类都含有一个 append() 函数，可直接向文件中写入
log 的设计也是围绕这个 append() 函数展开的

- FileUtil 封装了最底层的文件类，包括文件的打开、写入、关闭文件等，底层使用了标准 IO，该 append() 函数可直接向文件中写

- LogFile 进一步封装了 FileUtil，并设置了 loop 次数，每个这么长时间刷新以下缓冲区

- AsyncLogging 是核心，它负责启动一个 log 线程，专门将产生的 log 写入文件当中，应用双缓冲区技术，其中有多个缓冲区成对时出
现，AsyncLogging 负责将缓冲区的数据写入文件

- LogStream 主要用于格式化输出，重载输出流运算符，同时也有自己的缓冲区，这里的缓存是为了缓存一行，把多个流输出连成一块

- Logging 是对外的接口，Logging 包含了一个 LogStream 对象，主要是为了每次打印 log 的时候，在 log 前后加上固定的格式信息，比如 log 所处的函数、所处行等信息
